(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[185],{721:function(e,t,n){Promise.resolve().then(n.bind(n,4486))},8516:function(e,t,n){"use strict";n.d(t,{JT:function(){return u},ZP:function(){return f},am:function(){return d}});var o=n(7437),s=n(2265),r=n(4307),l=n(4630),a=n(9124),i=n(2871),c=n(408);let u=(0,s.createContext)(),d=e=>{let{children:t}=e,[n,r]=(0,s.useState)(null);return(0,s.useEffect)(()=>{let e=localStorage.getItem("profile");console.debug("restored profile:",e),r(e?JSON.parse(e):null)},[]),(0,o.jsx)(u.Provider,{value:{profile:n,setProfile:e=>{localStorage.setItem("profile",JSON.stringify(e)),console.debug("saved profile to localStorage:",JSON.stringify(e)),r(e)}},children:t})};function f(e){let{selectedProfile:t,setSelectedProfile:n}=e,{profiles:s,error:u,isLoading:d}=(0,c.nw)();return d?(0,o.jsx)("div",{children:"Loading profiles..."}):u?(0,o.jsx)("div",{children:"Error!"}):0===s.length?(0,o.jsx)("div",{children:"No profiles found."}):(0,o.jsxs)(r.Ri,{value:t,onChange:n,children:[(0,o.jsx)(l.__,{className:"mt-2 block text-sm font-medium leading-6 text-gray-900",children:"Profile"}),t&&!s.map(e=>e.name).includes(t.name)&&(0,o.jsx)("div",{children:"Profile is missing."}),(0,o.jsxs)("div",{className:"relative mt-2 mb-2",children:[(0,o.jsx)(r.Y4,{className:"relative w-full cursor-default rounded-md bg-white py-1.5 pl-1 pr-10 text-left text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 sm:text-sm sm:leading-6",children:(0,o.jsxs)("span",{className:"flex items-center",children:[(0,o.jsx)("span",{className:"ml-3 block truncate",children:t?t.name:""}),(0,o.jsxs)("span",{className:"ml-2 text-slate-400 text-sm font-light",children:["@",t?t.host?t.host:"localhost":""]}),(0,o.jsx)("span",{className:"pointer-events-none absolute inset-y-0 right-0 flex items-center pr-2",children:(0,o.jsx)(a.Z,{className:"h-5 w-5 text-gray-400","aria-hidden":"true"})})]})}),(0,o.jsx)(r.O_,{className:"absolute z-10 mt-1 max-h-60 overflow-auto rounded-md bg-white py-1 text-base shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none sm:text-sm w-[var(--button-width)]",anchor:"bottom",children:s.map(e=>(0,o.jsxs)(r.wt,{value:e,className:"group flex gap-2 bg-white data-[focus]:bg-blue-500 data-[focus]:text-white relative cursor-default select-none py-2 pl-1 pr-9 text-gray-900",children:[(0,o.jsx)("div",{className:"flex",children:(0,o.jsx)("span",{className:"ml-3 block truncate font-normal data-[selected]:font-semibold",children:e.name})}),(0,o.jsxs)("span",{className:"ml-1 text-slate-400 text-sm font-light data-[selected]:text-gray-100",children:["@",e.host?e.host:"localhost"]}),(0,o.jsx)("span",{className:"invisible group-data-[selected]:visible absolute inset-y-0 right-0 flex items-center pr-4 group-data-[focus]:text-white text-blue-600",children:(0,o.jsx)(i.Z,{className:"size-5"})})]},e.name))})]})]})}},9657:function(e,t,n){"use strict";function o(){return"http://".concat("localhost",":").concat("8000","/api")}n.d(t,{Z:function(){return o}})},4486:function(e,t,n){"use strict";let o,s;n.r(t),n.d(t,{default:function(){return R}});var r,l=n(7437),a=n(6722),i=n.n(a);n(7960);var c=n(9376),u=n(8516),d=n(2664),f=n(1323),m=n(2265),p=n(6750),h=n(8036),x=n(4),g=n(3689),v=n(4723),b=n(3252),y=n(7863),E=n(7634),j=n(4536),w=n(293),N=n(7847);let S=null!=(r=m.startTransition)?r:function(e){e()};var P=n(7388),_=((o=_||{})[o.Open=0]="Open",o[o.Closed=1]="Closed",o),I=((s=I||{})[s.ToggleDisclosure=0]="ToggleDisclosure",s[s.CloseDisclosure=1]="CloseDisclosure",s[s.SetButtonId=2]="SetButtonId",s[s.SetPanelId=3]="SetPanelId",s[s.SetButtonElement=4]="SetButtonElement",s[s.SetPanelElement=5]="SetPanelElement",s);let T={0:e=>({...e,disclosureState:(0,j.E)(e.disclosureState,{0:1,1:0})}),1:e=>1===e.disclosureState?e:{...e,disclosureState:1},2:(e,t)=>e.buttonId===t.buttonId?e:{...e,buttonId:t.buttonId},3:(e,t)=>e.panelId===t.panelId?e:{...e,panelId:t.panelId},4:(e,t)=>e.buttonElement===t.element?e:{...e,buttonElement:t.element},5:(e,t)=>e.panelElement===t.element?e:{...e,panelElement:t.element}},k=(0,m.createContext)(null);function D(e){let t=(0,m.useContext)(k);if(null===t){let t=Error("<".concat(e," /> is missing a parent <Disclosure /> component."));throw Error.captureStackTrace&&Error.captureStackTrace(t,D),t}return t}k.displayName="DisclosureContext";let C=(0,m.createContext)(null);C.displayName="DisclosureAPIContext";let O=(0,m.createContext)(null);function F(e,t){return(0,j.E)(t.type,T,e,t)}O.displayName="DisclosurePanelContext";let Z=m.Fragment,L=N.VN.RenderStrategy|N.VN.Static,B=Object.assign((0,N.yV)(function(e,t){let{defaultOpen:n=!1,...o}=e,s=(0,m.useRef)(null),r=(0,g.T)(t,(0,g.h)(e=>{s.current=e},void 0===e.as||e.as===m.Fragment)),l=(0,m.useReducer)(F,{disclosureState:n?0:1,buttonElement:null,panelElement:null,buttonId:null,panelId:null}),[{disclosureState:a,buttonId:i},c]=l,u=(0,h.z)(e=>{c({type:1});let t=(0,w.r)(s);if(!t||!i)return;let n=e?e instanceof HTMLElement?e:e.current instanceof HTMLElement?e.current:t.getElementById(i):t.getElementById(i);null==n||n.focus()}),d=(0,m.useMemo)(()=>({close:u}),[u]),f=(0,m.useMemo)(()=>({open:0===a,close:u}),[a,u]),p=(0,N.L6)();return m.createElement(k.Provider,{value:l},m.createElement(C.Provider,{value:d},m.createElement(b.Z,{value:u},m.createElement(y.up,{value:(0,j.E)(a,{0:y.ZM.Open,1:y.ZM.Closed})},p({ourProps:{ref:r},theirProps:o,slot:f,defaultTag:Z,name:"Disclosure"})))))}),{Button:(0,N.yV)(function(e,t){let n=(0,m.useId)(),{id:o="headlessui-disclosure-button-".concat(n),disabled:s=!1,autoFocus:r=!1,...l}=e,[a,i]=D("Disclosure.Button"),c=(0,m.useContext)(O),u=null!==c&&c===a.panelId,v=(0,m.useRef)(null),b=(0,g.T)(v,t,(0,h.z)(e=>{if(!u)return i({type:4,element:e})}));(0,m.useEffect)(()=>{if(!u)return i({type:2,buttonId:o}),()=>{i({type:2,buttonId:null})}},[o,i,u]);let y=(0,h.z)(e=>{var t;if(u){if(1===a.disclosureState)return;switch(e.key){case P.R.Space:case P.R.Enter:e.preventDefault(),e.stopPropagation(),i({type:0}),null==(t=a.buttonElement)||t.focus()}}else switch(e.key){case P.R.Space:case P.R.Enter:e.preventDefault(),e.stopPropagation(),i({type:0})}}),j=(0,h.z)(e=>{e.key===P.R.Space&&e.preventDefault()}),w=(0,h.z)(e=>{var t;(0,E.P)(e.currentTarget)||s||(u?(i({type:0}),null==(t=a.buttonElement)||t.focus()):i({type:0}))}),{isFocusVisible:S,focusProps:_}=(0,d.F)({autoFocus:r}),{isHovered:I,hoverProps:T}=(0,f.X)({isDisabled:s}),{pressed:k,pressProps:C}=(0,p.x)({disabled:s}),F=(0,m.useMemo)(()=>({open:0===a.disclosureState,hover:I,active:k,disabled:s,focus:S,autofocus:r}),[a,I,k,S,s,r]),Z=(0,x.f)(e,a.buttonElement),L=u?(0,N.dG)({ref:b,type:Z,disabled:s||void 0,autoFocus:r,onKeyDown:y,onClick:w},_,T,C):(0,N.dG)({ref:b,id:o,type:Z,"aria-expanded":0===a.disclosureState,"aria-controls":a.panelElement?a.panelId:void 0,disabled:s||void 0,autoFocus:r,onKeyDown:y,onKeyUp:j,onClick:w},_,T,C);return(0,N.L6)()({ourProps:L,theirProps:l,slot:F,defaultTag:"button",name:"Disclosure.Button"})}),Panel:(0,N.yV)(function(e,t){let n=(0,m.useId)(),{id:o="headlessui-disclosure-panel-".concat(n),transition:s=!1,...r}=e,[l,a]=D("Disclosure.Panel"),{close:i}=function e(t){let n=(0,m.useContext)(C);if(null===n){let n=Error("<".concat(t," /> is missing a parent <Disclosure /> component."));throw Error.captureStackTrace&&Error.captureStackTrace(n,e),n}return n}("Disclosure.Panel"),[c,u]=(0,m.useState)(null),d=(0,g.T)(t,(0,h.z)(e=>{S(()=>a({type:5,element:e}))}),u);(0,m.useEffect)(()=>(a({type:3,panelId:o}),()=>{a({type:3,panelId:null})}),[o,a]);let f=(0,y.oJ)(),[p,x]=(0,v.Y)(s,c,null!==f?(f&y.ZM.Open)===y.ZM.Open:0===l.disclosureState),b=(0,m.useMemo)(()=>({open:0===l.disclosureState,close:i}),[l.disclosureState,i]),E={ref:d,id:o,...(0,v.X)(x)},j=(0,N.L6)();return m.createElement(y.uu,null,m.createElement(O.Provider,{value:l.panelId},j({ourProps:E,theirProps:r,slot:b,defaultTag:"div",features:L,visible:p,name:"Disclosure.Panel"})))})});function M(e){let{task:t}=e,n=(0,c.usePathname)().endsWith("login"),o=async e=>{e.preventDefault();let t=await fetch("/api/logout",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include"});if(!t.ok){let e=Error("Failed to logout (status=".concat(t.status,")."));e.status=t.status,console.log(e)}t.redirected&&(window.location.href=t.url)};return(0,l.jsx)(B,{as:"nav",className:"bg-white",children:e=>{let{open:s}=e;return(0,l.jsx)(l.Fragment,{children:(0,l.jsx)("div",{className:"mx-auto px-4 sm:px-6 lg:px-8",children:(0,l.jsxs)("div",{className:"flex h-16 justify-between",children:[(0,l.jsxs)("div",{className:"flex",children:[(0,l.jsx)("div",{className:"-ml-2 mr-2 flex items-center md:hidden"}),(0,l.jsxs)("div",{className:"flex flex-shrink-0 items-center",children:[(0,l.jsx)("a",{href:"/dashboard",children:(0,l.jsx)("img",{className:"h-8 w-auto",src:"/img/orca.png",alt:"blackfish"})}),(0,l.jsx)("div",{className:"pl-4 text-4xl font-bold",children:"blackfish"}),(0,l.jsx)("div",{className:"pl-4 text-4xl font-extralight text-slate-300 italic",children:t})]})]}),!n&&(0,l.jsx)("div",{className:"flex items-center",children:(0,l.jsx)("button",{onClick:o,className:"rounded-md bg-slate-700 w-16 px-3 py-2 mt-2 text-sm font-semibold text-white shadow-sm hover:bg-slate-600 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-slate-600",children:"Exit"})})]})})})}})}function R(e){let{children:t}=e,n=(0,c.usePathname)();return(0,l.jsxs)("html",{lang:"en",children:[(0,l.jsx)("link",{rel:"icon",href:"/img/favicon.ico",sizes:"any"}),(0,l.jsx)("body",{className:i().className,children:(0,l.jsxs)(u.am,{children:[(0,l.jsx)(M,{task:n.slice(1)}),t]})})]})}},408:function(e,t,n){"use strict";n.d(t,{Su:function(){return l},bP:function(){return r},nw:function(){return a},of:function(){return i}});var o=n(3861),s=n(3347);let r=(e,t)=>{let{data:n,error:r,isLoading:l}=(0,o.ZP)("models?profile=".concat(e?e.name:"default","&image=").concat(t),s.fm);return{models:n,error:r,isLoading:l}},l=(e,t)=>{let{data:n,error:r,isLoading:l,mutate:a}=(0,o.ZP)("services?profile=".concat(e?e.name:"default","&image=").concat(t.replace("-","_")),s.Qz,{refreshInterval:1e4}),i=["HEALTHY","STARTING","PENDING","SUBMITTED","STOPPED","EXPIRED","TIMEOUT","FAILED"];return{services:n?[...n].sort((e,t)=>{let n=i.indexOf(e.status)-i.indexOf(t.status);return 0!==n?n:new Date(t.created_at)-new Date(e.created_at)}):[],error:r,isLoading:l,mutate:a}},a=()=>{let{data:e,error:t,isLoading:n,mutate:r}=(0,o.ZP)("profiles",s.lU);return{profiles:e,error:t,isLoading:n,mutate:r}},i=e=>{let{data:t,error:n,isLoading:r,mutate:l}=(0,o.ZP)(e?"files?path=".concat(e):null,s.uB);return{files:t,error:n,isLoading:r,refresh:l}}},3347:function(e,t,n){"use strict";n.d(t,{Pp:function(){return d},Qz:function(){return l},UY:function(){return i},fm:function(){return r},lU:function(){return a},uB:function(){return s},uv:function(){return u},wo:function(){return f}});let o=(0,n(9657).Z)();async function s(e){let t=await fetch("".concat(o,"/").concat(e));if(!t.ok){let e=Error("Failed to fetch files.");throw e.status=t.status,console.error(e),e}return t.json()}async function r(e){let t=await fetch("".concat(o,"/").concat(e,"&refresh=true"));if(!t.ok){let e=Error("Failed to fetch models.");throw e.status=t.status,console.error(e),e}return(await t.json()).map(e=>({repo_id:e.repo,revision:e.revision,profile:e.profile,image:e.image,model_dir:e.model_dir}))}async function l(e){let t=await fetch("".concat(o,"/").concat(e));if(!t.ok){let e=Error("Failed to fetch services.");throw e.status=t.status,console.error(e),e}return await t.json()}async function a(){let e=await fetch("".concat(o,"/profiles"));if(!e.ok){console.log("Failed to fetch profiles.");let t=Error("Failed to fetch profiles.");throw t.status=e.status,console.log(t),t}return await e.json()}async function i(e,t,n,s,r){let l;if("slurm"===r.type)l={name:n.name,image:e.replace("-","_"),model:t.repo_id,profile:r.name,job_type:"slurm",host:r.host,user:r.user,job_options:n,container_options:{...s,revision:t.revision,model_dir:"speech-recognition"===e?c(t.model_dir):t.model_dir}};else if("local"===r.type){let a=await fetch("".concat(o,"/ports"));if(!a.ok){let e=Error("Unable to find available local port");throw e.status=a.status,e}let i=await a.json();l={name:n.name,image:e.replace("-","_"),model:t.repo_id,profile:r.name,job_type:"local",host:"localhost",job_options:{},container_options:{...s,revision:t.revision,model_dir:"speech-recognition"===e?c(t.model_dir):t.model_dir,port:i}}}else throw Error("Unsupported job profile type: ".concat(r.type));return console.debug("body:",l),await fetch("".concat(o,"/services"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)})}function c(e){let t=e.split("/"),n=t.length;return t.slice(0,n-1).join("/")}async function u(e){let t=await fetch("".concat(o,"/services/").concat(e),{method:"GET",headers:{"Content-Type":"application/json"},mode:"cors"});if(!t.ok)throw Error("Failed to get service details.");return t.json()}async function d(e){let t=JSON.stringify({delay:0}),n=await fetch("".concat(o,"/services/").concat(e,"/stop"),{method:"PUT",headers:{"Content-Type":"application/json"},mode:"cors",body:t});if(!n.ok)throw Error("Failed to stop the service");return n.json()}async function f(e){let t=JSON.stringify({force:!1});if(!(await fetch("".concat(o,"/services/").concat(e),{method:"DELETE",headers:{"Content-Type":"application/json"},mode:"cors",body:t})).ok)throw Error("Failed to delete the service")}},7960:function(){},6722:function(e){e.exports={style:{fontFamily:"'__Inter_d65c78', '__Inter_Fallback_d65c78'",fontStyle:"normal"},className:"__className_d65c78"}}},function(e){e.O(0,[361,501,248,971,117,744],function(){return e(e.s=721)}),_N_E=e.O()}]);